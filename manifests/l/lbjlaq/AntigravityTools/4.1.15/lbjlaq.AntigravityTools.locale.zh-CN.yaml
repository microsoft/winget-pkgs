# Created with YamlCreate.ps1 Dumplings Mod
# yaml-language-server: $schema=https://aka.ms/winget-manifest.defaultLocale.1.12.0.schema.json

PackageIdentifier: lbjlaq.AntigravityTools
PackageVersion: 4.1.15
PackageLocale: zh-CN
Publisher: lbjlaq
PublisherUrl: https://github.com/lbjlaq
PublisherSupportUrl: https://github.com/lbjlaq/Antigravity-Manager/issues
PackageName: Antigravity Tools
PackageUrl: https://github.com/lbjlaq/Antigravity-Manager
License: CC-BY-NC-SA-4.0
LicenseUrl: https://github.com/lbjlaq/Antigravity-Manager/blob/HEAD/LICENSE
ShortDescription: 专业的 Antigravity 账号管理与切换工具。为 Antigravity 提供一键无缝账号切换功能。
Description: |-
  Antigravity Tools 是一个专为开发者和 AI 爱好者设计的全功能桌面应用。它将多账号管理、协议转换和智能请求调度完美结合，为您提供一个稳定、极速且成本低廉的 本地 AI 中转站。
  通过本应用，您可以将常见的 Web 端 Session (Google/Anthropic) 转化为标准化的 API 接口，彻底消除不同厂商间的协议鸿沟。
ReleaseNotes: |-
  - [核心功能] 开启 macOS 与 Windows 原生自动更新支持 (PR #1850):
    - 端到端自动更新：启用了 Tauri 的原生更新插件，支持在应用内直接检测、下载并安装更新。
    - 发布工作流修复：彻底修复了 Release 工作流中生成更新元数据 (updater.json) 的逻辑。现在系统会自动根据 .sig 签名文件构建完整的更新索引，支持 darwin-aarch64, darwin-x86_64 以及 windows-x86_64 架构。
    - 体验打通：配合前端已有的更新提醒组件，实现了从发布到安装的全自动化闭环。
  - [核心修复] 解决切换账号时由于空 Project ID 导致的 400 错误 (PR #1852):
    - 空值过滤：在 Proxy 层增加了对 project_id 的空字符串过滤逻辑。
    - 自动纠错：当检测到账号数据中的 project_id 为空时，现在会触发自动重新获取流程，有效解决了 Issue #1846 和 #1851 中提到的 "Invalid project resource name projects/" 错误。
  - [故障排查] 针对 HTTP 404 "Resource projects/... not found" 的解决建议 (Issue #1858):
    - 验证项目 ID: 登录 Google Cloud Console，在项目选择器中搜索报错提到的 ID（如 bold-spark-xxx）。若项目不存在，请创建新项目并启用所需的 Vertex AI API。
    - 重置账户会话：尝试在 Antigravity 应用中“删除账户”并“重新添加”，以清除旧的会话残留。
    - CLI 辅助验证：建议使用 Gemini CLI (gcloud auth login) 重新进行身份验证，并确保 gcloud config set project 指向了正确的有效项目。
  - [故障排查] 针对 HTTP 403 "Forbidden" 错误的解决建议 (Issue #1834):
    - 检查验证链接：请检查 API 响应中是否包含提示 "To continue, verify your account at..." 的链接。若有，请点击该链接并按照 Google 提示完成验证。
    - 确认计划资格：访问 FAQ 页面 确认您的账号是否符合 Google One AI 计划或 Gemini Code Assist 的使用要求。
    - 自动恢复：部分 403 错误（如触发风险控制或配额调整）可能会在等待一段时间后自动恢复正常。
  - [核心修复] Cloudflared 公网访问设置持久化 (Issue #1805):
    - 设置记忆：修复了 Cloudflared (CF Tunnel) 的 Token、隧道模式及 HTTP/2 设置在应用重启后丢失的问题。
    - 热更新同步：实现了设置的实时持久化。现在切换隧道模式、修改 Token (失焦同步) 或切换 HTTP/2 选项时，配置都会立即保存，确保重启后恢复如初。
  - [核心修复] 修复 Warmup 过程中的 403 禁用标记 (PR #1803):
    - 禁用识别：修复了账号在 Warmup (预热) 过程中返回 403 错误时未被标记为 is_forbidden 的问题。
    - 自动跳过：现在 Warmup 过程中检测到 403 将立即标记并持久化账号禁用状态，并在后续的调度、预热和配额检查中自动跳过该账号，避免无效请求。
  - [UI 优化] 迷你视图 (Mini View) 状态显示与交互增强 (PR #1816):
    - 状态指示点：在迷你视图底部新增了请求状态圆点。成功 (200-399) 显示为绿色，失败显示为红色，直观反馈最近一次请求结果。
    - 模型名称回退：优化了模型名称显示逻辑。当 mapped_model 为空时，自动回退显示原始模型 ID 而非 "Unknown"，提升信息透明度。
    - 刷新动画优化：改进了刷新按钮的动画效果，使旋转动画仅作用于 RefreshCw 图标本身，交互更加细腻。
  - [核心功能] Claude 4.6 Adaptive Thinking 模式支持：
    - Dynamic Effort: 全面支持 effort 参数 (low/medium/high)，允许用户动态调整模型的思考深度与预算。
    - Token 限制自适应：修复了 Adaptive 模式下 maxOutputTokens 未能正确感知 Budget 导致被截断的问题，确保长思维链不被腰斩。
  - [文档更新] 新增 Adaptive 模式测试用例：
    - 提供了 docs/adaptive_mode_test_examples.md，涵盖多轮对话、复杂任务场景及 Budget 模式切换的完整验证指南。
  - [核心功能] 图片生成 imageSize 参数支持：
    - 直接参数支持：新增对 Gemini 原生 imageSize 参数的直接支持，可在所有协议(OpenAI/Claude/Gemini)中使用。
    - 参数优先级：实现了清晰的参数优先级逻辑：imageSize 参数 > quality 参数推断 > 模型后缀推断。
    - 全协议兼容：OpenAI Chat API、Claude Messages API 和 Gemini 原生协议均支持通过 imageSize 字段直接指定分辨率("1K"/"2K"/"4K")。
    - 向后兼容：完全兼容现有的 quality 参数和模型后缀方式，不影响现有代码。
  - [核心功能] Opencode 提供商隔离与清理工作流 (PR #1820):
    - 隔离同步逻辑：实现 Opencode 提供商的独立同步机制，防止状态污染，确保数据纯净。
    - 清理工作流：新增资源清理工作流，优化资源管理，提升系统运行效率。
    - 稳定性增强：增强了同步过程的稳定性和可靠性。
  - [核心功能] Homebrew Cask 安装检测与支持 (PR #1673):
    - 应用升级：新增了对 Homebrew Cask 安装的检测逻辑。如果应用是通过 Cask 安装的，现在可以直接在应用内触发 brew upgrade --cask 流程，实现无缝升级体验。
  - [核心修复] Gemini 图像生成配额保护 (PR #1764):
    - 保护生效：修复了配额保护机制可能会错误统计文本请求的问题，并确保在绘图配额耗尽时能正确拦截 gemini-3-pro-image 的请求。
  - [UI 优化] 修复导航栏边界与显示问题 (PR #1636):
    - 边界修复：修复了导航栏右侧菜单在特定窗口宽度下可能超出边界或显示不全的问题。
    - 兼容性：此次合并保留了主分支上的 Mini View 等新特性，只应用了必要的样式修正。
  - [UI 优化] 修复英文模式下的布局溢出与水平滚动 (Issue #1783):
    - 全局限制：在全局样式中封锁了水平轴溢出，杜绝了因文字过长导致的页面横向抖动。
    - 响应式增强：优化了导航栏断点，将文字胶囊的显示阈值提高至 1120px，确保长英文标签在窄窗口下自动切换为图标模式，保持布局整洁。
  - [核心修复] 修复处理复杂 JSON Schema 时可能发生的栈溢出问题 (Issue #1781):
    - 安全加固：为 flatten_refs 等深度递归逻辑引入了 MAX_RECURSION_DEPTH (10) 限制，有效防止了由循环引用或过深嵌套导致的程序崩溃。
  - [核心修复] 修复流式输出下多个工具调用被错误拼接的问题 (Issue #1786):
    - 索引校正：修正了 create_openai_sse_stream 中 tool_calls 的索引分配逻辑，确保同一个 chunk 中的多个工具调用拥有独立且连续的 index，避免了参数被错误拼接导致解析失败的现象。
  - [核心修复] 修复 Claude Thinking 模型多轮对话时的签名错误 (Issue #1790):
    - 签名注入与降级：在 OpenAI 协议转换层中增加了对历史消息思考块签名的自动注入逻辑。当无法获取有效签名时，自动将其降级为普通文本块，从而解决了 Claude-opus-thinking 等模型在多轮对话中因签名缺失导致的 HTTP 400 错误。
  - [核心修复] 修复 Google Cloud 项目 ID 获取失败导致的 503 错误 (Issue #1794):
    - 增加兜底：修复了由于账号权限导致无法获取官方项目 ID 时会跳过该账号的 Bug。现在系统会自动回退到经验证稳定的通用 Project ID (bamboo-precept-lgxtn)，确保 API 请求的连续性。
  - [i18n] 完善 Settings 与 ApiProxy 国际化支持 (PR #1789):
    - 重构：将 Settings.tsx 和 ApiProxy.tsx 中硬编码的中文字符串替换为 t() 国际化调用。
    - 翻译补全：同步更新了韩语、缅甸语、葡萄牙语、俄语、土耳其语、越南语、繁体中文和简体中文的本地化词条。
  - [核心修复] 修复 IP 白名单删除失败问题 (Issue #1797):
    - 参数规范化：修复了由于前端与后端参数命名风格 (snake_case vs camelCase) 不一致导致无法删除白名单 IP 的问题。同时统一了黑名单管理与 IP 访问日志的相关参数，确保全系统参数传递的一致性。
ReleaseNotesUrl: https://github.com/lbjlaq/Antigravity-Manager/releases/tag/v4.1.15
ManifestType: defaultLocale
ManifestVersion: 1.12.0
